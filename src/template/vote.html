<html>
	<head>
    <meta name="viewport" content="width=100%; initial-scale=1; maximum-scale=1; minimum-scale=1; user-scalable=no;" />

		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
		<script type="text/javascript" src="https://raw.github.com/jyoungblood/smoke.js/master/smoke/smoke.min.js"></script>
        <link href="https://raw.github.com/jyoungblood/smoke.js/master/base.css" rel="stylesheet" type="text/css" />
            
        <style>
            html, body {
                margin: 0;
                padding: 0;
            }

            .smoke-base {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
                visibility: hidden;
                opacity: 0;
                -moz-transition: all .3s;
                -webkit-transition: opacity .3s;
                -o-transition: all .3s;
                transition: all .3s;
            }
            .smoke-base.smoke-visible {
                opacity: 1;
                visibility: visible;
            }
            
            .smokebg {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
            }

            .smoke-base .dialog {
                position: absolute
            }

            .dialog-prompt {
                margin-top: 5px;
                text-align: center;
            }

            .dialog-buttons {
                margin: 10px 0 5px 0
            }

            .smoke {
                font-family: sans-serif;
                font-weight: bold;
                text-align: center;
                font-size: 18px;
                line-height: 130%;
            }

            .dialog-buttons button {
                display: inline-block;
                vertical-align: baseline;
                cursor: pointer;
                font-family: sans-serif;
                font-style: normal;
                text-decoration: none;
                border: 0;
                outline: 0;
                margin: 0 5px;
                -webkit-background-clip: padding-box;
                font-size: 13px;
                line-height: 13px;
                font-weight: bold;
                padding: 9px 12px;
            }

            .dialog-prompt input {
                margin: 0;
                border: 0;
                font-family: sans-serif;
                outline: none;
                border: 1px solid #333;
                width: 97%;
                background-color: #fff;
                font-size: 15px;
                padding: 5px;
            }

            .smoke-base {
                color: #000;
                background: rgba(0,0,0,.3);
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#90000000,endColorstr=#900000000);
            }

            .smoke-base .dialog {
                top: 25%;
                left: 25%;
                width: 50%;
            }

            .smoke-base .dialog-inner {
                padding: 15px
            }

            .smoke {
                text-transform: uppercase;
                background-color: rgba(255,255,255,1);
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#ffffff,endColorstr=#ffffff);
            }

            .dialog-buttons button {
                border-radius: 5px;
                text-transform: uppercase;
                background-color: rgba(0,0,0,.9);
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#222222,endColorstr=#222222);
                color: #fff;
            }

            button.cancel {
                background-color: rgba(0,0,0,.7);
                filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=#444444,endColorstr=#444444);
            }

            .queue{
                display:none;
            }

            body {
                color: white;
                font-family: "Helvetica", Helvetica, sans-serif;
                background: #1a1b1f;
            }

        #default {
            position: relative;    
        }
        .center{
            width: 100%;
            margin: 0 auto;
        } 
        ul {
            list-style: none;    
            padding-left: 0px;
            margin-left: 0px;
        }
        .o_name {
            display: none;    
        }
        li {
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#68707e), color-stop(100%,#363b42)); /* Chrome,Safari4+ */
            background: -webkit-linear-gradient(top, #68707e 0%,#363b42 100%); /* Chrome10+,Safari5.1+ */
            background: linear-gradient(top, #68707e 0%,#363b42 100%); /* W3C */
            background: -moz-linear-gradient(top, #68707e 0%,#363b42 100%); /* W3C */
            height: 60px;
            width: 100%;
            position: relative;
            border-bottom: 1px solid #1a1b1f;
        }
        li:before {
            border-top: 1px solid #b5b9c0;
            height: 1px;
            width: 100%;
            position: absolute;
            top: 1px;
            left: 0px;
            content: '';
        }
        .info {
            padding-top: 5px;
        }
        .info span {
                display: block;    
            }
             img {
                float: left;
                margin-right: 10px;
                margin-left : 5px;
                margin-top: 5px;
                border: 1px solid #7e7e7e;
            }

            .status {
                float: right;
                margin-top: 5px;
                margin-right: 10px;
            } 
            .votes {
                display: block;
                font-size: 18px;
                text-align: center;
            }
            .name {
                font-size: 16px;
                line-height: 16px;
            }
            .artist {
                font-size: 14px;    
                line-height: 16px;
            }
            .album {
                font-size: 10px;    
                line-height: 12px;
            }
#now_playing .status span {
                font-style: italic;
               font-size: 12px; 
            }

            .id {
                display: none;   
                visibility: hidden;
            }

            .button {
                text-align: center;
                height: 40px;
                line-height: 40px;
                margin: 5px auto;
                border: 1px solid #444;
                border-radius: 5px;
                -moz-border-radius: 5px;
                -webkit-border-radius: 5px;
                background: -moz-linear-gradient(top, #5b5c5e 0%, #2d2f38 100%); /* FF3.6+ */
                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#5b5c5e), color-stop(100%,#2d2f38)); /* Chrome,Safari4+ */
                background: -webkit-linear-gradient(top, #5b5c5e 0%,#2d2f38 100%); /* Chrome10+,Safari5.1+ */
                background: linear-gradient(top, #5b5c5e 0%,#2d2f38 100%); /* W3C */
                -webkit-box-shadow: 0px 0px 3px 0px #000000;
                -moz-box-shadow: 0px 0px 3px 0px #000000;
                box-shadow: 0px 0px 3px 0px #000000; 
            }
            
            .button:active {
                background: -moz-linear-gradient(top, #2d2f38 0%, #5b5c5e 100%); /* FF3.6+ */
                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#2d2f38), color-stop(100%,#5b5c5e)); /* Chrome,Safari4+ */
                background: -webkit-linear-gradient(top, #2d2f38 0%,#5b5c5e 100%); /* Chrome10+,Safari5.1+ */
                background: linear-gradient(top, #2d2f38 0%,#5b5c5e 100%); /* W3C */
                -webkit-box-shadow: 0px 0px 0px 0px #000000;
                -moz-box-shadow: 0px 0px 0px 0px #000000;
                box-shadow: 0px 0px 0px 0px #000000; 
            }

            .btn {
                border: 1px solid #444;
                border-radius: 5px;
                background: #2a2b2f;
            }
            .search {
                border: 1px solid #666;
                border-radius: 5px;
                font-size: 18px;
                height: 36px;
                line-height: 36px;
                padding: 2px 2%;
                margin: 10px 0;
                width: 98%;
            }
            #nav {
                width: 102%;
                position: fixed;
                z-index: 10;
                top: 0px;
                left: -3px;
                background: #1a1b1f;
                padding-bottom: 5px;
            }
            .list {
                margin-top: 200px;
            }
            .sort-by {
                margin-top: 10px;
                margin-left: 0;
                padding-left: 0;
            }
            .sort {
                width: 25%;
                height: auto;
                padding: 10px 5px;
                margin: 0 3% 10px 0;
                text-align: center;
                float: left;
                background: -moz-linear-gradient(top, #5b5c5e 0%, #2d2f38 100%); /* FF3.6+ */
                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#5b5c5e), color-stop(100%,#2d2f38)); /* Chrome,Safari4+ */
                background: -webkit-linear-gradient(top, #5b5c5e 0%,#2d2f38 100%); /* Chrome10+,Safari5.1+ */
                background: linear-gradient(top, #5b5c5e 0%,#2d2f38 100%); /* W3C */
            }

            .sort:active {
                background: -moz-linear-gradient(top, #2d2f38 0%, #5b5c5e 100%); /* FF3.6+ */
                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#2d2f38), color-stop(100%,#5b5c5e)); /* Chrome,Safari4+ */
                background: -webkit-linear-gradient(top, #2d2f38 0%,#5b5c5e 100%); /* Chrome10+,Safari5.1+ */
                background: linear-gradient(top, #2d2f38 0%,#5b5c5e 100%); /* W3C */
            }

            .sort:before {
                border: none !important;
                height: 0;
                width: 0;
            }
            </style>
		</head>
		<body>
            <div id="song_list" class="center">
            <div id="nav">
                <ul class="sort-by">
                    <li class="sort btn" rel="name">
                        Sort by name
                    </li>
                    <li class="sort btn" rel="artist">
                        Sort by artist
                    </li>
                    <li class="sort btn" rel="album">
                        Sort by album
                    </li>
                </ul>
                <input class="search" placeholder="Search for your song..." />
                <div class="button" style="width: auto">View Queued</div>
            </div>
            <ul class="list">
			{% for song in songs %}
				{% block song %}
				<li>
                    <img src="{{ song.imgurl() }}" height="50" width="50" />
                    <span class="img" style="display: none; visibility: hidden;">{{ song.imgurl() }}</span>
                    <div class="status">
                        {% if song.playing %}
                            <span style="font-style: italic">Now playing</span>
                            <span class="votes" style="display: none; visibility: hidden;">{{ song.votes }}</span>
                        {% else %}
                            <span class="votes">{{ song.votes }}</span>
                            <span>Votes</span>
                        {% end %}
                        <span class="playing" style="display: none; visiblility:hidden;">{{ song.playing }}</span>
                    </div>
                    <div class="info">
                        {% if len(song.name) > 20 %}
                            <span class="name" >{{ song.name[0:17] }}...</span>
                        {% else %}
                            <span class="name">{{ song.name }}</span>
                        {% end %}
                        <span class="artist">{{ song.artist }}</span>
                        <span class="album">{{ song.album }}</span>
                    </div>
                    <span class="o_name">{{ song.name }}</span>
                    <span class="id">{{ song.id }}</span>
                </li>
				{% end %}
			{% end %}
		</ul>
        </div>
		<script type="text/javascript" src="https://raw.github.com/javve/list/master/list.min.js"></script>
        <script type="text/javascript">
          var options = {
                valueNames: ["votes", "playing", "name", "artist", "album", "id"]  
          };

          var songList = new List('song_list', options);
            
            var Observer = function(val) {
                this.item = val;
                this.listeners = [];
                this.size = 0;
                return this;
            }

            Observer.prototype = {
                subscribe: function (fn) {
                    this.listeners.push(fn);    
                },
                val: function(vals, thisObj) {
                    if (!vals) {
                        return this.item;    
                    }
                    var scope = thisObj || window;
                    if (vals != this.item) {
                        this.item = vals;
                        this.listeners.forEach(function(el){
                            el.call(scope, vals); 
                        });   
                    }
                }
                
            }

            var views = ["default", "queued",  "songs"];
            var view = new Observer(views[0]);
            view.subscribe(function(val){
                console.log("View is now: " + val);
                if (val == views[1]) {
                    songList.filter(function(vals){
                        if (vals.votes > 0) {
                            return true;    
                        }
                        return false;
                    });
                }
                if (val == views[2]) {
                    songList.filter(function(vals){
                        return true;    
                    });
                }
            });

                    
             
            $('.button').click(function(el) {
                var $but = $(this);
                var txt = $but.text();
                if (txt == "View Queued") {
                    view.val(views[1]);
                    $but.text("View Songs");
                    $('.sort-by').hide();
                }
                if (txt == "View Songs") {
                    view.val(views[2]);    
                    $but.text("View Queued");
                    $('.sort-by').show();
                }
            });
    

            $('#song_list .list li').click(function() {
                var $t = $(this);
                var n = $t.children('.o_name').text();
                var id = $t.children('.id').text();
                smoke.confirm("Do you want to vote for " + n + "?", function(e) {
                    if (e) {
                        $.post('/vote', {"song_list": id}, function(v) {
                            var temp = songList.get("id", id);
                            temp.values({votes: v});
                            smoke.signal("Voted for " + n);    
                        });
                    }
                });
            });

			</script>
        </body>
</html>
